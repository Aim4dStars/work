<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="tbl-dealer_product" author="m034259" dbms="h2">
        <sqlFile path="persistence/schema/h2/dealer_product.sql"/>
    </changeSet>
    <changeSet id="tbl-tracking" author="m034259" dbms="h2">
        <sqlFile path="persistence/schema/h2/tracking.sql"/>
    </changeSet>
    <changeSet id="tbl-dealer_product" author="m034259" dbms="oracle">
        <sqlFile path="persistence/schema/oracle/dealer_product.tbl"/>
    </changeSet>
    <changeSet id="tbl-tracking" author="m034259" dbms="oracle">
        <sqlFile path="persistence/schema/oracle/tracking.tbl"/>
    </changeSet>
    <changeSet id="seq-tracking" author="m034259" dbms="oracle">
        <sqlFile path="persistence/schema/oracle/tracking.seq"/>
    </changeSet>
    <changeSet id="draft_account-drop" author="l071142" dbms="h2">
        <preConditions onFail="MARK_RAN" onFailMessage="DRAFT_ACCOUNT does not exist and does not need to be dropped">
            <tableExists tableName="DRAFT_ACCOUNT"/>
        </preConditions>
        <dropTable cascadeConstraints="true"
                   schemaName="public"
                   tableName="DRAFT_ACCOUNT"/>
    </changeSet>
    <changeSet id="draft_account-drop" author="l070813" dbms="oracle">
        <preConditions onFail="MARK_RAN" onFailMessage="DRAFT_ACCOUNT does not exist and does not need to be dropped">
            <tableExists tableName="DRAFT_ACCOUNT"/>
        </preConditions>
        <dropTable cascadeConstraints="true"
                   tableName="DRAFT_ACCOUNT"/>
    </changeSet>
    <changeSet id="draft_account_seq-drop" author="l071142">
        <preConditions onFail="MARK_RAN" onFailMessage="DRAFT_ACCOUNT_SEQ does not exist and does not need to be dropped">
            <sequenceExists sequenceName="DRAFT_ACCOUNT_SEQ"/>
        </preConditions>
        <dropSequence sequenceName="DRAFT_ACCOUNT_SEQ"/>
    </changeSet>
    <changeSet id="client_application_seq-create" author="l071142">
        <createSequence sequenceName="CLIENT_APPLICATION_SEQ" startValue="1" incrementBy="1"/>
    </changeSet>
    <changeSet id="client_application-create" author="l071142">
        <createTable tableName="CLIENT_APPLICATION">
            <column name="CLIENT_APPLICATION_ID" type="NUMBER">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="ADVISER_ID" type="VARCHAR(20)"/>
            <column name="LAST_MODIFIED" type="TIMESTAMP"/>
            <column name="LAST_MODIFIED_ID" type="VARCHAR(20)"/>
            <column name="FORM_DATA" type="CLOB"/>
            <column name="STATUS" type="VARCHAR(10)" defaultValue="draft"/>
        </createTable>
    </changeSet>
    <changeSet id="gcm_audit_trail-drop" author="l069679" dbms="oracle">
        <validCheckSum>7:81593d0a61ebf6f5eb507ed7d34921f4</validCheckSum>
        <preConditions onFail="MARK_RAN" onFailMessage="DRAFT_ACCOUNT does not exist and does not need to be dropped">
            <tableExists tableName="GCM_AUDIT_TRAIL"/>
        </preConditions>
        <dropTable cascadeConstraints="true"
                   tableName="GCM_AUDIT_TRAIL"/>
    </changeSet>
    <changeSet id="gcm_audit_trail_seq-create" author="L069679">
        <createSequence sequenceName="AUDIT_LOG_SEQ" startValue="1" incrementBy="1"/>
    </changeSet>
    <changeSet id="gcm_audit_trail-create" author="L069679">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="GCM_AUDIT_TRAIL"/>
            </not>
        </preConditions>
        <createTable tableName="GCM_AUDIT_TRAIL">            
            <column name="AUDIT_LOG_ID" type="NUMBER">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="USER_ID" type="VARCHAR(20)"/>
            <column name="TIMESTAMP" type="TIMESTAMP"/>
            <column name="SILO" type="VARCHAR(20)"/>
            <column name="REQ_TYPE" type="VARCHAR(100)"/>
            <column name="REQ_MSG" type="CLOB"/>
        </createTable>
    </changeSet>
    <changeSet id="silo_movement_status-drop" author="L091297" dbms="oracle">
     	<validCheckSum>7:976a8e965b34b07adc5d40ba47fec6a2</validCheckSum>
        <preConditions onFail="MARK_RAN" onFailMessage="DRAFT_ACCOUNT does not exist and does not need to be dropped">
            <tableExists tableName="SILO_MOVEMENT_STATUS"/>
        </preConditions>
        <dropTable cascadeConstraints="true"
                   tableName="SILO_MOVEMENT_STATUS"/>
    </changeSet>
    <changeSet id="silo_movement_status_seq-create" author="L091297">
        <createSequence sequenceName="SILO_MOVEMENT_STATUS_SEQ" startValue="1" incrementBy="1"/>
    </changeSet>
    <changeSet id="silo_movement_status-create" author="L091297">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="SILO_MOVEMENT_STATUS"/>
            </not>
        </preConditions>
        <createTable tableName="SILO_MOVEMENT_STATUS">            
            <column name="ID" type="NUMBER">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="APP_ID" type="VARCHAR(20)"/>
            <column name="USER_ID" type="VARCHAR(20)"/>
            <column name="DATETIME_START" type="TIMESTAMP"/>
            <column name="DATETIME_END" type="TIMESTAMP"/>
            <column name="OLD_CIS" type="VARCHAR(20)"/>
            <column name="NEW_CIS" type="VARCHAR(20)"/>
            <column name="FROM_SILO" type="VARCHAR(20)"/>
            <column name="TO_SILO" type="VARCHAR(20)"/>
            <column name="LAST_SUCC_STATE" type="VARCHAR(100)"/>
            <column name="ERR_STATE" type="VARCHAR(20)"/>
            <column name="ERR_MSG" type="VARCHAR(200)"/>
        </createTable>
    </changeSet>
    <changeSet id="modify-errmsg-column-of-silomovementstatus" author="L091297">
    	<dropColumn tableName="SILO_MOVEMENT_STATUS" columnName="ERR_MSG"/>
    	<addColumn tableName="SILO_MOVEMENT_STATUS"><column name="ERR_MSG" type="CLOB"></column></addColumn>
    </changeSet>
    <changeSet id="serviceops_log_seq-drop" author="l081050" dbms="oracle">
        <validCheckSum>7:81593d0a61ebf6f5eb507ed7d34921f4</validCheckSum>
        <preConditions onFail="MARK_RAN" onFailMessage="SERVICEOPS_AUDIT_LOG does not exist and does not need to be dropped">
            <tableExists tableName="SERVICEOPS_AUDIT_LOG"/>
        </preConditions>
        <dropTable cascadeConstraints="true"
                   tableName="SERVICEOPS_AUDIT_LOG"/>
    </changeSet>
    <changeSet id="serviceops_log_seq-create" author="l081050">
        <createSequence sequenceName="SERVICEOPS_LOG_SEQ" startValue="1" incrementBy="1"/>
    </changeSet>
    <changeSet id="serviceops_audit_log-create" author="l081050">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="SERVICEOPS_AUDIT_LOG"/>
            </not>
        </preConditions>
        <createTable tableName="SERVICEOPS_AUDIT_LOG">            
            <column name="LOG_ID" type="NUMBER">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="USER_ID" type="VARCHAR(20)"/>
            <column name="TIMESTAMP" type="TIMESTAMP"/>
            <column name="ACTION" type="VARCHAR(100)"/>
            <column name="MESSAGE" type="VARCHAR(200)"/>           
		</createTable>
    </changeSet>
    <changeSet id="modify-status-column-of-clientapplication" author="L070354">
        <modifyDataType tableName="CLIENT_APPLICATION" columnName="STATUS" newDataType="VARCHAR2(15)"/>
    </changeSet>
    <changeSet id="client_application-add-status-check-constraint" author="l071142">
        <sql>ALTER TABLE CLIENT_APPLICATION ADD CONSTRAINT client_application_chk_status CHECK( STATUS IN ('draft','deleted','submitted'))</sql>
    </changeSet>
    <!-- sprocs -->
    <changeSet id="proc-insert_or_update_app_id" author="m034259" dbms="oracle" runOnChange="true">
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/insert_or_update_app_id.proc" />
    </changeSet>
    <changeSet id="proc-insert_or_update_account_id" author="m034259" dbms="oracle" runOnChange="true">
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/insert_or_update_account_id.proc" />
    </changeSet>
    <changeSet id="proc-insert_or_update_party_id" author="m034259" dbms="oracle" runOnChange="true">
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/insert_or_update_party_id.proc" />
    </changeSet>
    <changeSet id="proc-insert_or_update_address_id" author="m034259" dbms="oracle" runOnChange="true">
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/insert_or_update_address_id.proc" />
    </changeSet>
    <changeSet id="proc-update_application_status" author="m034259" dbms="oracle" runOnChange="true">
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/update_application_status.proc" />
    </changeSet>
    <changeSet id="proc-update_account_status" author="m034259" dbms="oracle" runOnChange="true">
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/update_account_status.proc" />
    </changeSet>
    <changeSet id="proc-update_party_status" author="m034259" dbms="oracle" runOnChange="true">
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/update_party_status.proc" />
    </changeSet>
    <changeSet id="tracking-tables-drop" author="l070813">
        <dropTable cascadeConstraints="true" tableName="communication"/>
        <dropTable cascadeConstraints="true" tableName="address"/>
        <dropTable cascadeConstraints="true" tableName="party"/>
        <dropTable cascadeConstraints="true" tableName="account"/>
        <dropTable cascadeConstraints="true" tableName="application"/>
    </changeSet>
    <changeSet id="tracking-sequences-drop" author="l070813">
        <dropSequence sequenceName="ui_address_id_seq"/>
        <dropSequence sequenceName="ui_account_id_seq"/>
        <dropSequence sequenceName="ui_party_id_seq"/>
        <dropSequence sequenceName="ui_application_id_seq"/>
    </changeSet>
    <changeSet id="drop-proc-insert_or_update_app_id" author="l070813" dbms="oracle" runOnChange="true">
        <dropProcedure procedureName="insert_or_update_app_id"/>
    </changeSet>
    <changeSet id="drop-proc-insert_or_update_account_id" author="l070813" dbms="oracle" runOnChange="true">
        <dropProcedure procedureName="insert_or_update_account_id"/>
    </changeSet>
    <changeSet id="drop-proc-insert_or_update_party_id" author="l070813" dbms="oracle" runOnChange="true">
        <dropProcedure procedureName="insert_or_update_party_id"/>
    </changeSet>
    <changeSet id="drop-proc-insert_or_update_address_id" author="l070813" dbms="oracle" runOnChange="true">
        <dropProcedure procedureName="insert_or_update_address_id"/>
    </changeSet>
    <changeSet id="drop-proc-update_application_status" author="l070813" dbms="oracle" runOnChange="true">
        <dropProcedure procedureName="update_application_status"/>
    </changeSet>
    <changeSet id="drop-proc-update_account_status" author="l070813" dbms="oracle" runOnChange="true">
        <dropProcedure procedureName="update_account_status"/>
    </changeSet>
    <changeSet id="drop-proc-update_party_status" author="l070813" dbms="oracle" runOnChange="true">
        <dropProcedure procedureName="update_party_status"/>
    </changeSet>
    <changeSet id="onboarding_application-create" author="l070813">
        <createTable tableName="ONBOARDING_APPLICATION">
            <column name="ID" type="NUMBER(20)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="APPLICATION_TYPE" type="VARCHAR(10)"/>
            <column name="AVALOQ_ORDER_ID" type="VARCHAR2(30)"/>
            <column name="STATUS" type="VARCHAR(30)"/>
            <column name="FAILURE_MESSAGE" type="VARCHAR(500)"/>
            <column name="LAST_MODIFIED_DATE" type="TIMESTAMP"/>
            <column name="LAST_MODIFIED_ID" type="VARCHAR(20)"/>
        </createTable>
    </changeSet>
    <changeSet id="account-correlation-create" author="l070813">
        <createTable tableName="ONBOARDING_ACCOUNT">
            <column name="ONBOARDING_ACCOUNT_SEQ" type="NUMBER(3)">
                <constraints nullable="false"/>
            </column>
            <column name="ONBOARDING_APPLICATION_ID" type="NUMBER(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ACCOUNT_NUMBER" type="VARCHAR2(30)"/>
            <column name="LAST_MODIFIED_DATE" type="TIMESTAMP"/>
            <column name="LAST_MODIFIED_ID" type="VARCHAR(20)"/>
        </createTable>
    </changeSet>
    <changeSet id="add-onboarding-account-fk-constraint" author="l070813">
        <addForeignKeyConstraint baseColumnNames="ONBOARDING_APPLICATION_ID"
                                 baseTableName="ONBOARDING_ACCOUNT"
                                 constraintName="FK_ACCOUNT_APP_CORRELATION"
                                 referencedColumnNames="ID"
                                 referencedTableName="ONBOARDING_APPLICATION"/>
    </changeSet>
    <changeSet id="add-onboarding-account" author="l070813" >
        <addPrimaryKey columnNames="ONBOARDING_APPLICATION_ID,ONBOARDING_ACCOUNT_SEQ"
                       tableName="ONBOARDING_ACCOUNT"/>
    </changeSet>
    <changeSet id="party-create" author="l070813">
        <createTable tableName="ONBOARDING_PARTY">
            <column name="ONBOARDING_PARTY_SEQ" type="NUMBER(3)">
                <constraints nullable="false"/>
            </column>
            <column name="ONBOARDING_APPLICATION_ID" type="NUMBER(20)">
                <constraints nullable="false"/>
            </column>
            <column name="GCM_PAN" type="VARCHAR2(30)"/>
            <column name="STATUS" type="VARCHAR(30)"/>
            <column name="FAILURE_MESSAGE" type="VARCHAR(500)"/>
            <column name="LAST_MODIFIED_DATE" type="TIMESTAMP"/>
            <column name="LAST_MODIFIED_ID" type="VARCHAR(20)"/>
        </createTable>
    </changeSet>
    <changeSet id="add-onboarding-party-fk-constraint" author="l070813">
        <addForeignKeyConstraint baseColumnNames="ONBOARDING_APPLICATION_ID"
                                 baseTableName="ONBOARDING_PARTY"
                                 constraintName="FK_PARTY_APP_CORRELATION"
                                 referencedColumnNames="ID"
                                 referencedTableName="ONBOARDING_APPLICATION"/>
    </changeSet>
    <changeSet id="add-party-primary-key" author="l070813" >
        <addPrimaryKey columnNames="ONBOARDING_APPLICATION_ID,ONBOARDING_PARTY_SEQ"
                       tableName="ONBOARDING_PARTY"/>
    </changeSet>
    <changeSet id="alter-client-application-add-fk-col" author="l070813">
        <addColumn tableName="CLIENT_APPLICATION">
            <column name="ONBOARDING_APPLICATION_ID" type="NUMBER(20)"/>
        </addColumn>
    </changeSet>
    <changeSet id="alter-dealer-products-add-laf-col" author="l062605">
        <addColumn tableName="DEALER_PRODUCTS">
            <column name="LICENSEE_FEE" type="BIT"/>
        </addColumn>
    </changeSet>
    <changeSet id="add-client-application-fk-constraint" author="l070813">
        <addForeignKeyConstraint baseColumnNames="ONBOARDING_APPLICATION_ID"
                                 baseTableName="CLIENT_APPLICATION"
                                 constraintName="FK_CLIENT_ONBOARDING_APP"
                                 referencedColumnNames="ID"
                                 referencedTableName="ONBOARDING_APPLICATION"/>
    </changeSet>
    <changeSet id="onboarding_application_seq-create" author="l071142">
        <createSequence sequenceName="ONBOARDING_APPLICATION_SEQ" startValue="1" incrementBy="1"/>
    </changeSet>
    <changeSet id="package-onboarding_id_updates" author="l070813" dbms="oracle" runOnChange="true">
        <sqlFile  endDelimiter="\n/\s*\n|\n/\s*$" splitStatements="true" path="persistence/schema/oracle/onboarding_id_updates.pks" />
        <sqlFile  endDelimiter="\n/\s*\n|\n/\s*$" splitStatements="true" path="persistence/schema/oracle/onboarding_id_updates.pkb" />
    </changeSet>

    <changeSet id="package-onboarding_status_updates" author="l070813" dbms="oracle" runOnChange="true">
        <sqlFile  endDelimiter="\n/\s*\n|\n/\s*$" splitStatements="true" path="persistence/schema/oracle/onboarding_status_updates.pks" />
        <sqlFile  endDelimiter="\n/\s*\n|\n/\s*$" splitStatements="true" path="persistence/schema/oracle/onboarding_status_updates.pkb" />
    </changeSet>

    <changeSet id="proc-reg_ob_correlation_xml_schema" author="l070813" dbms="oracle" runOnChange="true">
        <sqlFile  endDelimiter="\n/\s*\n|\n/\s*$" splitStatements="true" path="persistence/schema/oracle/reg_ob_correlation_xml_schema.proc" />
        <sql>CALL REG_OB_CORRELATION_XML_SCHEMA();</sql>
    </changeSet>
    <changeSet id="communication-create" author="l070813">
        <createTable tableName="ONBOARDING_COMMUNICATION">
            <column name="COMMUNICATION_ID" type="VARCHAR(30)">
            <constraints nullable="false"/>
        </column>
            <column name="ONBOARDING_APPLICATION_ID" type="NUMBER(20)">
                <constraints nullable="false"/>
            </column>
            <column name="GCM_PAN" type="VARCHAR2(30)">
                <constraints nullable="false"/>
            </column>
            <column name="STATUS" type="VARCHAR(30)"/>
            <column name="EMAIL_ADDRESS" type="VARCHAR(300)"/>
            <column name="BUSINESS_TS" type="TIMESTAMP"/>
            <column name="LAST_MODIFIED_DATE" type="TIMESTAMP"/>
            <column name="LAST_MODIFIED_ID" type="VARCHAR(20)"/>
        </createTable>
    </changeSet>
    <changeSet id="add-onboarding-communication-fk-constraint" author="l070813">
        <addForeignKeyConstraint baseColumnNames="ONBOARDING_APPLICATION_ID"
                                 baseTableName="ONBOARDING_COMMUNICATION"
                                 constraintName="FK_COMM_APP_CORRELATION"
                                 referencedColumnNames="ID"
                                 referencedTableName="ONBOARDING_APPLICATION"/>
    </changeSet>
    <changeSet id="add-communication-primary-key" author="l070813" >
        <addPrimaryKey columnNames="ONBOARDING_APPLICATION_ID,COMMUNICATION_ID"
                       tableName="ONBOARDING_COMMUNICATION"/>
    </changeSet>
    <changeSet id="package-onboarding_communication" author="l070813" dbms="oracle" runOnChange="true">
        <sqlFile  endDelimiter="\n/\s*\n|\n/\s*$" splitStatements="true" path="persistence/schema/oracle/onboarding_communication.pks" />
        <sqlFile  endDelimiter="\n/\s*\n|\n/\s*$" splitStatements="true" path="persistence/schema/oracle/onboarding_communication.pkb" />
    </changeSet>

    <changeSet id="renameColumn-example" author="L069260">
        <renameColumn
            oldColumnName="adviser_id"
            newColumnName="adviser_position_id"
            tableName="client_application"/>
    </changeSet>

    <changeSet id="add_unique_constraint-client_application" author="L070813">
        <addUniqueConstraint columnNames="onboarding_application_id"
                             constraintName="unique_onboarding_app"
                             tableName="client_application"/>
    </changeSet>

    <changeSet id="increase_failure_message_length-onboarding_application" author="L070813" >
        <modifyDataType columnName="FAILURE_MESSAGE"
                        newDataType="VARCHAR2(4000)"
                        tableName="ONBOARDING_APPLICATION"/>
    </changeSet>

    <changeSet id="increase_application_type_length-onboarding_application" author="M013938">
        <modifyDataType tableName="ONBOARDING_APPLICATION" columnName="APPLICATION_TYPE" newDataType="VARCHAR(64)"/>
    </changeSet>

    <changeSet id="add-offline_approval-column-onboarding_application" author="M013938">
        <addColumn tableName="ONBOARDING_APPLICATION">
            <column name="OFFLINE_APPROVAL" type="BOOLEAN" defaultValueBoolean="false"/>
        </addColumn>
    </changeSet>

    <changeSet id="increase_failure_message_length-onboarding_party" author="L070813" >
        <modifyDataType columnName="FAILURE_MESSAGE"
                        newDataType="VARCHAR2(4000)"
                        tableName="ONBOARDING_PARTY"/>
    </changeSet>

    <changeSet id="client_application-remove-status-constraint" author="samfoo">
        <sql>ALTER TABLE CLIENT_APPLICATION DROP CONSTRAINT client_application_chk_status;</sql>
        <rollback>
            <sql>ALTER TABLE CLIENT_APPLICATION ADD CONSTRAINT client_application_chk_status CHECK( STATUS IN ('draft','deleted','submitted'))</sql>
        </rollback>

    </changeSet>

    <changeSet id="client_application-add-status-check-constraint2" author="l069260">
        <sql>ALTER TABLE CLIENT_APPLICATION ADD CONSTRAINT client_application_chk_status CHECK( STATUS IN ('draft','deleted','processing', 'active'));</sql>
        <rollback>
            <sql>
                ALTER TABLE CLIENT_APPLICATION DROP CONSTRAINT client_application_chk_status;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="client_application-remove-status-constraint-for-docupload" author="l070354">
        <sql>ALTER TABLE CLIENT_APPLICATION DROP CONSTRAINT client_application_chk_status;</sql>
        <rollback>
            <sql>ALTER TABLE CLIENT_APPLICATION ADD CONSTRAINT client_application_chk_status CHECK( STATUS IN ('draft','deleted','processing', 'active'))</sql>
        </rollback>

    </changeSet>

    <changeSet id="client_application-add-status-check-constraint-for-docupload" author="l070354">
        <sql>ALTER TABLE CLIENT_APPLICATION ADD CONSTRAINT client_application_chk_status CHECK( STATUS IN ('draft','deleted','processing','active','docuploaded'));</sql>
        <rollback>
            <sql>
                ALTER TABLE CLIENT_APPLICATION DROP CONSTRAINT client_application_chk_status;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="alter-client-application-add-product-id" author="l071468">
        <addColumn tableName="CLIENT_APPLICATION">
            <column name="PRODUCT_ID" type="VARCHAR(50)"/>
        </addColumn>
        <rollback>
        <dropColumn tableName="CLIENT_APPLICATION" columnName="PRODUCT_ID"/>
        </rollback>
    </changeSet>

    <changeSet id="alter-onboarding_communication" author="L070813">
        <modifyDataType columnName="EMAIL_ADDRESS"
                        newDataType="VARCHAR(100)"
                        tableName="ONBOARDING_COMMUNICATION"/>
        <renameColumn
                oldColumnName="BUSINESS_TS"
                newColumnName="COMMUNICATION_INITIATION_TIME"
                tableName="ONBOARDING_COMMUNICATION"/>
        <addColumn tableName="ONBOARDING_COMMUNICATION">
            <column name="TRACKING_ID" type="VARCHAR(30)"/>
            <column name="CREATED_DATE" type="TIMESTAMP"/>
            <column name="FAILURE_MESSAGE" type="VARCHAR(4000)"/>
        </addColumn>
        <rollback>
            <modifyDataType columnName="EMAIL_ADDRESS"
                            newDataType="VARCHAR(300)"
                            tableName="ONBOARDING_COMMUNICATION"/>
            <renameColumn
                    oldColumnName="COMMUNICATION_INITIATION_TIME"
                    newColumnName="BUSINESS_TS"
                    tableName="ONBOARDING_COMMUNICATION"/>
            <dropColumn tableName="ONBOARDING_COMMUNICATION" columnName="TRACKING_ID"/>
            <dropColumn tableName="ONBOARDING_COMMUNICATION" columnName="CREATED_DATE"/>
            <dropColumn tableName="ONBOARDING_COMMUNICATION" columnName="FAILURE_MESSAGE"/>
        </rollback>
    </changeSet>

    <changeSet id="alter-onboarding_communication-primary_key" author="l070813">
        <dropPrimaryKey tableName="ONBOARDING_COMMUNICATION"/>
        <sql>DELETE FROM ONBOARDING_COMMUNICATION;</sql>
        <addPrimaryKey columnNames="COMMUNICATION_ID" tableName="ONBOARDING_COMMUNICATION"/>
    </changeSet>


    <!-- THERE WILL BE SPLIT INTO SEPARATE CHANGES<changeSet id="add-unique_constraint-onboarding_party" author="L070813">-->
        <!--<sql>DELETE FROM ONBOARDING_PARTY WHERE GCM_PAN IS NULL;</sql>-->
        <!--<addNotNullConstraint columnName="GCM_PAN" columnDataType="VARCHAR2" tableName="ONBOARDING_PARTY"/>-->
        <!--<addUniqueConstraint columnNames="ONBOARDING_APPLICATION_ID, GCM_PAN"-->
                             <!--constraintName="UNIQUE_ONBOARDING_APP_PARTY"-->
                             <!--tableName="ONBOARDING_PARTY"/>-->
    <!--</changeSet>-->

    <!--<changeSet id="alter-onboarding_communication-fk_constraint" author="l070813">-->
        <!--<dropForeignKeyConstraint constraintName="FK_COMM_APP_CORRELATION"-->
                                  <!--baseTableName="ONBOARDING_COMMUNICATION"/>-->
        <!--<addForeignKeyConstraint baseColumnNames="ONBOARDING_APPLICATION_ID, GCM_PAN"-->
                                 <!--baseTableName="ONBOARDING_COMMUNICATION"-->
                                 <!--constraintName="FK_COMM_APP_PARTY_CORRELATION"-->
                                 <!--referencedColumnNames="ONBOARDING_APPLICATION_ID, GCM_PAN"-->
                                 <!--referencedTableName="ONBOARDING_PARTY"/>-->
    <!--</changeSet>-->


    <!-- Splitting add-unique_constraint-onboarding_party changeSet -->
    <changeSet id="delete-party-if-gcm_pan-null" author="L070813">
        <sql>DELETE FROM ONBOARDING_PARTY WHERE GCM_PAN IS NULL;</sql>
    </changeSet>

    <changeSet id="add-gcm_pan-not-null-constraint-onboarding_party" author="L070813">
        <preConditions onFail="MARK_RAN">
            <not>
                <changeSetExecuted id="add-unique_constraint-onboarding_party" author="L070813" changeLogFile="persistence/db.changelog-2.0.xml"/>
            </not>
        </preConditions>
        <addNotNullConstraint columnName="GCM_PAN" columnDataType="VARCHAR2" tableName="ONBOARDING_PARTY"/>
    </changeSet>

    <changeSet id="add-unique-constraint-onboarding_party" author="L070813">
        <preConditions onFail="MARK_RAN">
            <not>
                <changeSetExecuted id="add-unique_constraint-onboarding_party" author="L070813" changeLogFile="persistence/db.changelog-2.0.xml"/>
            </not>
        </preConditions>
        <addUniqueConstraint columnNames="ONBOARDING_APPLICATION_ID, GCM_PAN"
                             constraintName="UNIQUE_ONBOARDING_APP_PARTY"
                             tableName="ONBOARDING_PARTY"/>
    </changeSet>


    <!-- Splitting alter-onboarding_communication-fk_constraint changeSet -->
    <changeSet id="drop-foreign-key-constraint-onboarding_communication" author="L070813">
        <preConditions onFail="MARK_RAN">
            <not>
                <changeSetExecuted id="alter-onboarding_communication-fk_constraint" author="L070813" changeLogFile="persistence/db.changelog-2.0.xml"/>
            </not>
        </preConditions>
        <dropForeignKeyConstraint constraintName="FK_COMM_APP_CORRELATION"
                                  baseTableName="ONBOARDING_COMMUNICATION"/>
    </changeSet>
    <changeSet id="add-onboarding_communication-fk_constraint" author="L070813">
        <preConditions onFail="MARK_RAN">
            <not>
                <changeSetExecuted id="alter-onboarding_communication-fk_constraint" author="L070813" changeLogFile="persistence/db.changelog-2.0.xml"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="ONBOARDING_APPLICATION_ID, GCM_PAN"
                                 baseTableName="ONBOARDING_COMMUNICATION"
                                 constraintName="FK_COMM_APP_PARTY_CORRELATION"
                                 referencedColumnNames="ONBOARDING_APPLICATION_ID, GCM_PAN"
                                 referencedTableName="ONBOARDING_PARTY"/>
    </changeSet>

    <changeSet id="increase_communication_id_length-onboarding_communication" author="L070813" >
        <modifyDataType columnName="COMMUNICATION_ID"
                        newDataType="VARCHAR2(50)"
                        tableName="ONBOARDING_COMMUNICATION"/>
    </changeSet>
    <changeSet id="increase_tracking_id_length-onboarding_communication" author="L070813" >
        <modifyDataType columnName="TRACKING_ID"
                        newDataType="VARCHAR2(50)"
                        tableName="ONBOARDING_COMMUNICATION"/>
    </changeSet>
    
    <changeSet id="add__not_null_constraint-onboarding_communication-email_address" author="L070813">
        <addNotNullConstraint columnName="EMAIL_ADDRESS" columnDataType="VARCHAR2" tableName="ONBOARDING_COMMUNICATION"/>
    </changeSet>

    <changeSet id="add_not_null_constraint-onboarding_communication-communication_initiation" author="L070813">
        <addNotNullConstraint columnName="COMMUNICATION_INITIATION_TIME" columnDataType="VARCHAR2" tableName="ONBOARDING_COMMUNICATION"/>
    </changeSet>

    <changeSet id="add_not_null_constraint-onboarding_communication-created_date" author="L070813">
        <addNotNullConstraint columnName="CREATED_DATE" columnDataType="VARCHAR2" tableName="ONBOARDING_COMMUNICATION"/>
    </changeSet>

    <!--<changeSet id="add_whats_new_version_column-users-h2" author="f030695" dbms="h2" runOnChange="true">
        <comment>H2: Adds whats_new_version column to the users table</comment>
        <sqlFile path="persistence/schema/h2/update_users.sql"/>
    </changeSet>

    <changeSet id="add_whats_new_version_column-users-oracle" author="f030695" dbms="oracle" runOnChange="true">
        <comment>Oracle: Adds whats_new_version column to the users table</comment>
        <sqlFile path="persistence/schema/oracle/update_users.tbl"/>
    </changeSet>-->

    <!-- To add a new column, use liquibase' in built 'add column' function. Disabling the above two change sets
     and adding a new change set that will run on both H2 and Oracle. -->


    <changeSet id="add_column-whats_new_version-users" author="f030695">
        <preConditions onError="MARK_RAN" onFail="MARK_RAN">
            <not>
                <changeSetExecuted id="add_whats_new_version_column-users-h2" author="f030695" changeLogFile="persistence/db.changelog-2.0.xml"/>
            </not>
            <not>
                <changeSetExecuted id="add_whats_new_version_column-users-oracle" author="f030695" changeLogFile="persistence/db.changelog-2.0.xml"/>
            </not>
        </preConditions>
        <addColumn tableName="USERS">
            <column name="WHATS_NEW_VERSION" type="VARCHAR(50)"/>
        </addColumn>
    </changeSet>

	<changeSet id="request-register-create" author="l055167">
        <createTable tableName="REQUEST_REGISTER">
            <column name="SERVER_NAME" type="VARCHAR(100)"/>
            <column name="REQUEST_TYPE" type="VARCHAR(50)">
            	<constraints nullable="false"/>
            </column>
            <column name="EVENT_TYPE" type="VARCHAR(50)">
            	<constraints nullable="false"/>
            </column>
            <column name="SENT_TIME" type="DATETIME">
            	<constraints nullable="false"/>
            </column>
            <column name="RECEIVED_TIME" type="DATETIME"/>
            <column name="REQUEST_MODE" type="VARCHAR(20)"/>
        </createTable>
        <addPrimaryKey columnNames="REQUEST_TYPE,EVENT_TYPE"
                       tableName="REQUEST_REGISTER"/>
    </changeSet>

    <changeSet id="partial-invalidation-request-register-create" author="l054821">
        <createTable tableName="PARTIAL_INV_REGISTER">
            <column name="REQUEST_TYPE" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="EVENT_TYPE" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="PARAM_VAL" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_DATE" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="SENT_TIME" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="CORRELATION_ID" type="VARCHAR(100)" />
            <column name="REQUEST_MODE" type="VARCHAR(20)"/>
            <column name="SERVER_NAME" type="VARCHAR(100)"/>
        </createTable>
        <addPrimaryKey columnNames="REQUEST_TYPE,EVENT_TYPE,PARAM_VAL,CREATE_DATE"
                       tableName="PARTIAL_INV_REGISTER"/>
    </changeSet>

    <changeSet id="user-preference-create" author="f030695">
        <createTable tableName="USER_PREFERENCE">
            <column name="USER_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="PREFERENCE_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="VALUE" type="VARCHAR(2500)"/>
        </createTable>
        <addPrimaryKey columnNames="USER_ID,PREFERENCE_ID"
                       tableName="USER_PREFERENCE"/>
    </changeSet>

    <changeSet id="user-preference-alter" author="M035995">
        <modifyDataType tableName="USER_PREFERENCE" columnName="PREFERENCE_ID" newDataType="VARCHAR2(50)"/>
    </changeSet>

    <changeSet id="corporate-action-draft-election-create" author="m039879">
        <createTable tableName="CA_DRAFT_ELECTION">
            <column name="USER_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="CA_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ACCOUNT_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="EXPIRY_DATE" type="DATETIME"/>
            <column name="ELECTED_OPTION_ID" type="NUMBER"/>
            <column name="ELECTED_OPTION_HASH" type="VARCHAR(100)"/>
        </createTable>
        <addPrimaryKey columnNames="USER_ID, CA_ID, ACCOUNT_ID" tableName="CA_DRAFT_ELECTION"/>
    </changeSet>

    <changeSet id="proc-onboarding_application_clean" author="m022640" dbms="oracle" runOnChange="true" runAlways="false" failOnError="false">
	    <sqlFile endDelimiter="/" path="persistence/schema/oracle/onboarding_application_clean.proc" />
	    <sql>GRANT EXECUTE ON ONBOARDING_APPLICATION_CLEAN TO OPS$NGCTM</sql>
	    <sql>GRANT UPDATE, SELECT, INSERT, DELETE ON CLIENT_APPLICATION TO OPS$NGCTM</sql>
	    <sql>GRANT UPDATE, SELECT, INSERT, DELETE ON ONBOARDING_ACCOUNT TO OPS$NGCTM</sql>
	    <sql>GRANT UPDATE, SELECT, INSERT, DELETE ON ONBOARDING_COMMUNICATION TO OPS$NGCTM</sql>
	    <sql>GRANT UPDATE, SELECT, INSERT, DELETE ON ONBOARDING_PARTY TO OPS$NGCTM</sql>
	    <sql>GRANT UPDATE, SELECT, INSERT, DELETE ON ONBOARDING_APPLICATION TO OPS$NGCTM</sql>
    </changeSet>


    <changeSet id="push-notification-subscription-details-create" author="l062951">
        <createTable tableName="PUSH_SUBSCRIPTION_DETAILS">
            <column name="USER_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="DEVICE_UID" type="VARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="PLATFORM" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ACTIVE_FLAG" type="BIT"/>
        </createTable>
        <addPrimaryKey columnNames="DEVICE_UID,USER_ID"
                       tableName="PUSH_SUBSCRIPTION_DETAILS"/>
    </changeSet>

    <changeSet id="alter-ca-draft-election-add-units-oversubscribe-col" author="m039879">
        <addColumn tableName="CA_DRAFT_ELECTION">
            <column name="UNITS" type="NUMBER"/>
            <column name="OVERSUBSCRIBE" type="NUMBER"/>
        </addColumn>
    </changeSet>

    <changeSet id="user-role-terms-and-conditions-create" author="m035801">
        <createTable tableName="USER_ROLE_TNC">
            <column name="USER_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="PROFILE_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="TNC_ACCEPTED" type="CHAR(1)">
                <constraints nullable="false"/>
            </column>
            <column name="TNC_ACCEPTED_ON" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFY_DATETIME" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="VERSION" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="USER_ID, PROFILE_ID" tableName="USER_ROLE_TNC"/>
    </changeSet>

    <!-- Redesigned table as it no longer meets new requirements -->
    <changeSet id="draft_election-drop" author="m039879" dbms="h2">
        <preConditions onFail="MARK_RAN" onFailMessage="CA_DRAFT_ELECTION does not exist and does not need to be dropped">
            <tableExists tableName="CA_DRAFT_ELECTION"/>
        </preConditions>
        <dropTable cascadeConstraints="true"
                   schemaName="public"
                   tableName="CA_DRAFT_ELECTION"/>
    </changeSet>

    <changeSet id="draft_election-drop" author="m039879" dbms="oracle">
        <preConditions onFail="MARK_RAN" onFailMessage="CA_DRAFT_ELECTION does not exist and does not need to be dropped">
            <tableExists tableName="CA_DRAFT_ELECTION"/>
        </preConditions>
        <dropTable cascadeConstraints="true"
                   tableName="CA_DRAFT_ELECTION"/>
    </changeSet>

    <changeSet id="draft-ca-election-create" author="m039879">
        <createTable tableName="CA_DRAFT_PARTICIPATION">
            <column name="OE_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ORDER_NUMBER" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="EXPIRY_DATE" type="DATETIME"/>
        </createTable>
        <addPrimaryKey columnNames="OE_ID, ORDER_NUMBER" tableName="CA_DRAFT_PARTICIPATION"/>
    </changeSet>

    <changeSet id="draft-ca-account-create" author="m039879">
        <createTable tableName="CA_DRAFT_ACCOUNT">
            <column name="OE_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ORDER_NUMBER" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ACCOUNT_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="MINIMUM_PRICE_ID" type="NUMBER"/>
        </createTable>
        <addPrimaryKey columnNames="OE_ID, ORDER_NUMBER, ACCOUNT_ID" tableName="CA_DRAFT_ACCOUNT"/>
    </changeSet>

    <changeSet id="draft-ca-account-election-create" author="m039879">
        <createTable tableName="CA_DRAFT_ACCOUNT_ELECTION">
            <column name="OE_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ORDER_NUMBER" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ACCOUNT_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="OPTION_ID" type="NUMBER">
                <constraints nullable="false"/>
            </column>
            <column name="OPTION_HASH" type="VARCHAR(100)"/>
            <column name="UNITS" type="NUMBER"/>
            <column name="OVERSUBSCRIBE" type="NUMBER"/>
        </createTable>
        <addPrimaryKey columnNames="OE_ID, ORDER_NUMBER, ACCOUNT_ID, OPTION_ID" tableName="CA_DRAFT_ACCOUNT_ELECTION"/>
    </changeSet>

    <changeSet id="draft-ca-account-fk-constraint" author="m039879">
        <addForeignKeyConstraint baseColumnNames="OE_ID, ORDER_NUMBER"
                                 baseTableName="CA_DRAFT_ACCOUNT"
                                 constraintName="FK_CA_DRAFT_ACCOUNT"
                                 referencedColumnNames="OE_ID, ORDER_NUMBER"
                                 referencedTableName="CA_DRAFT_PARTICIPATION"/>
    </changeSet>

    <changeSet id="draft-ca-account-election-fk-constraint" author="m039879">
        <addForeignKeyConstraint baseColumnNames="OE_ID, ORDER_NUMBER, ACCOUNT_ID"
                                 baseTableName="CA_DRAFT_ACCOUNT_ELECTION"
                                 constraintName="FK_CA_DRAFT_ACCOUNT_ELECTION"
                                 referencedColumnNames="OE_ID, ORDER_NUMBER, ACCOUNT_ID"
                                 referencedTableName="CA_DRAFT_ACCOUNT"/>
    </changeSet>


    <changeSet author="m035801" id="drop-notnull-constraints-on-user-role-terms-and-conditions">
        <dropNotNullConstraint columnName="TNC_ACCEPTED"
                               columnDataType="VARCHAR(1)"
                               tableName="USER_ROLE_TNC"/>
        <dropNotNullConstraint columnName="TNC_ACCEPTED_ON"
                               columnDataType="DATE"
                               tableName="USER_ROLE_TNC"/>
        <dropNotNullConstraint columnName="VERSION"
                               columnDataType="INT"
                               tableName="USER_ROLE_TNC"/>
    </changeSet>

    <changeSet id="dealer_products-drop" author="l062329" dbms="h2">
        <preConditions onFail="MARK_RAN" onFailMessage="DEALER_PRODUCTS does not exist and does not need to be dropped">
            <tableExists tableName="DEALER_PRODUCTS"/>
        </preConditions>
        <dropTable cascadeConstraints="true"
                   tableName="DEALER_PRODUCTS"/>
    </changeSet>

    <changeSet id="dealer_products-drop" author="l062329" dbms="oracle">
        <preConditions onFail="MARK_RAN" onFailMessage="DEALER_PRODUCTS does not exist and does not need to be dropped">
            <tableExists tableName="DEALER_PRODUCTS"/>
        </preConditions>
        <dropTable cascadeConstraints="true"
                   tableName="DEALER_PRODUCTS"/>
    </changeSet>

    <changeSet id="mobile-app-version-create" author="l062951">
        <createTable tableName="MOBILE_APP_VERSION">
            <column name="PLATFORM" type="VARCHAR(20)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="VERSION" type="VARCHAR(20)"/>
        </createTable>
    </changeSet>

    <changeSet id="mobile-app-version-data-h2" author="l062951" dbms="h2" runOnChange="true" context="test-data">
        <comment>H2: Used to boot strap with initial mobile version data</comment>
        <sqlFile path="persistence/data/h2/app_version.sql"/>
    </changeSet>

    <changeSet id="mobile-app-version-data-oracle" author="l062951" dbms="oracle" runOnChange="true" context="test-data">
        <comment>Oracle: Used to boot strap with initial mobile version data</comment>
        <sqlFile endDelimiter="/" path="persistence/data/oracle/app_version.data"/>
    </changeSet>


    <changeSet id="westpac-products-table-create" author="f030695">
        <comment>This table contains the CPC, category, category in source system and ERT046 value of Westpac banking products.</comment>
        <createTable tableName="WESTPAC_PRODUCTS">
            <column name="CANONICAL_PRODUCT_CODE" type="VARCHAR(40)">
                <constraints nullable="false"/>
            </column>
            <column name="NAME" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="CATEGORY" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="CATEGORY_PRODUCT_SYSTEM" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="FUNDS_TRANSFER_FROM" type="CHAR(1)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="CANONICAL_PRODUCT_CODE" tableName="WESTPAC_PRODUCTS"/>
    </changeSet>

    <changeSet id="westpac-products-table-data-population-h2" author="f030695" dbms="h2" runOnChange="true">
        <comment>H2: Westpac product information</comment>
        <sqlFile path="persistence/data/h2/westpac_products.sql"/>
    </changeSet>

    <changeSet id="westpac-products-table-data-population-oracle" author="f030695" dbms="oracle" runOnChange="true">
        <comment>Oracle: Westpac product information</comment>
        <sqlFile path="persistence/data/oracle/westpac_products.data"/>
    </changeSet>

    <changeSet id="client-application-cis-key-create" author="f058391">
        <createTable tableName="CIS_KEY_CLIENT_APPLICATION">
            <column name="CIS_KEY" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="CLIENT_APPLICATION_ID" type="NUMBER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="cis-key-create" author="f058391" > 
    	<validCheckSum>7:6f226051885d8bc7080925ca79d975f8</validCheckSum>
        <createIndex indexName="idx_cis_key"
                     tableName="CIS_KEY_CLIENT_APPLICATION">
            <column name="CIS_KEY" type="VARCHAR(20)"/>
        </createIndex>
    </changeSet>
    <changeSet id="add-client-application-cis-key-fk-constraint" author="F058391">
        <addForeignKeyConstraint baseColumnNames="CLIENT_APPLICATION_ID"
                                 baseTableName="CIS_KEY_CLIENT_APPLICATION"
                                 constraintName="FK_CLIENT_APPLICATIONS_CIS_KEY"
                                 referencedColumnNames="CLIENT_APPLICATION_ID"
                                 referencedTableName="CLIENT_APPLICATION"/>
    </changeSet>


    <changeSet id="additional-subscribed-services" author="l062605">
        <createTable tableName="SUBSCRIPTIONS">
            <column name="DOC_ID" type="VARCHAR2(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ACCOUNT_ID" type="VARCHAR2(20)">
                <constraints nullable="false"/>
            </column>
            <column name="STATUS" type="VARCHAR2(20)">
                <constraints nullable="false"/>
            </column>
            <column name="SUBSCRIBE_TYPE" type="VARCHAR2(20)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="DOC_ID" tableName="SUBSCRIPTIONS"/>
    </changeSet>

    <changeSet id="additional-subscribed-services-update-subscribe-type" author="L062951">
        <modifyDataType tableName="SUBSCRIPTIONS" columnName="SUBSCRIBE_TYPE" newDataType="VARCHAR2(50)"/>
    </changeSet>

    <changeSet id="onboarding_party-increase-width-status" author="L071142">
        <sql>ALTER TABLE ONBOARDING_PARTY MODIFY STATUS VARCHAR2(40)</sql>
        <rollback>
            <sql>ALTER TABLE ONBOARDING_PARTY MODIFY STATUS VARCHAR2(30)</sql>
        </rollback>
    </changeSet>

    <changeSet id="existing-online-status-change" author="L071142">
        <sql>UPDATE ONBOARDING_PARTY SET STATUS = 'ExistingPanoramaOnlineUser' WHERE STATUS = 'ExistingOnlineUser'</sql>
        <rollback>
            <sql>UPDATE ONBOARDING_PARTY SET STATUS = 'ExistingOnlineUser' WHERE STATUS = 'ExistingPanoramaOnlineUser'</sql>
        </rollback>
    </changeSet>

    <changeSet id="tnc-ref-create" author="m121103">
    	<createTable tableName="TNC_REF">
            <column name="TNC_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="VERSION" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="DESCRIPTION" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFY_DATETIME" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>
    	<addPrimaryKey columnNames="TNC_ID, VERSION" tableName="TNC_REF"/>
    </changeSet>

    <changeSet id="tnc-ref-data-h2" author="m121103" dbms="h2" runOnChange="true" context="test-data">
        <comment>H2: Used to boot strap with tnc version data</comment>
        <sqlFile path="persistence/data/h2/tnc.sql"/>
    </changeSet>

    <changeSet id="tnc-ref-data-oracle" author="m121103" dbms="oracle" runOnChange="true">
        <comment>Oracle: Used to boot strap with tnc version data</comment>
        <sqlFile path="persistence/data/oracle/tnc.data"/>
    </changeSet>
    
    <changeSet id="user-tnc-create" author="m121103">       
        <createTable tableName="USER_TNC">
            <column name="USER_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="TNC_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="VERSION" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="TNC_ACCEPTED_ON" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="USER_ID, TNC_ID, VERSION" tableName="USER_TNC"/>
        <addForeignKeyConstraint baseColumnNames="TNC_ID, VERSION"
                                 baseTableName="USER_TNC"
                                 constraintName="FK_TNC_VERSION_CORRELATION"
                                 referencedColumnNames="TNC_ID, VERSION"
                                 referencedTableName="TNC_REF"/>
    </changeSet>

    <changeSet id="onboarding-log-seq-create" author="m036976">
        <createSequence sequenceName="ONBOARDING_LOG_SEQ" startValue="1" incrementBy="1"/>
    </changeSet>

    <changeSet id="onboarding-log-create" author="m036976">
    	<comment>Track onboarding application events that need logging</comment>
    	<createTable tableName="ONBOARDING_LOG">
    		<column name="LOG_ID" type="NUMBER(20)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
	    	<column name="ONBOARDING_APPLICATION_ID" type="NUMBER(20)">
	    		<constraints nullable="false"/>
	    	</column>
	    	<column name="CLIENT_GCM_ID" type="VARCHAR2(30)"/>
	    	<column name="STATUS" type="VARCHAR2(40)"/>
	    	<column name="FAILURE_MESSAGE" type="VARCHAR2(4000)"/>
	    	<column name="EVENT_TYPE" type="VARCHAR2(20)">
	    		<constraints nullable="false"/>
	    	</column>
	    	<column name="HAS_BEEN_LOGGED" type="NUMBER(1)">
	    		<constraints nullable="false"/>
	    	</column>
	    </createTable>
	    <rollback>
	    	<dropTable tableName="ONBOARDING_LOG"/>
	    </rollback>
    </changeSet>

    <changeSet id="onboarding-log-application-failure-trigger-oracle" author="m036976" dbms="oracle" runOnChange="true">
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/onboarding_log_application_failure_trigger.trig"/>
    </changeSet>
    
    <changeSet id="onboarding-log-party-failure-trigger-oracle" author="m036976" dbms="oracle" runOnChange="true">
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/onboarding_log_party_failure_trigger.trig"/>
    </changeSet>

    <changeSet id="notice_type-ref-create" author="l062951">
        <createTable tableName="NOTICE_TYPE_REF">
            <column name="NOTICE_ID" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="VERSION" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="DESCRIPTION" type="VARCHAR(500)">
            </column>
            <column name="LAST_UPDATED_ON" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="NOTICE_ID,VERSION" tableName="NOTICE_TYPE_REF"/>
    </changeSet>

    <changeSet id="user_notices_after_insert_trigger" author="l062951" dbms="oracle" runOnChange="true">
        <comment>Oracle: Used to create a trigger to populate user_notices when there is a new entry in NOTICE_TYPE_REF table</comment>
        <sqlFile endDelimiter="/" path="persistence/schema/oracle/user_notices_trigger.sql"/>
    </changeSet>


    <changeSet id="user-notices-create" author="l062951">
        <createTable tableName="USER_NOTICES">
            <column name="USER_ID" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="NOTICE_ID" type="VARCHAR(50)">
                <constraints referencedTableName="NOTICE_TYPE_REF" foreignKeyName="NOTICE_ID" nullable="false"/>
            </column>
            <column name="VERSION" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="LAST_VIEWED_ON" type="DATE">
            </column>
        </createTable>
        <addPrimaryKey columnNames="USER_ID,NOTICE_ID,VERSION"
                       tableName="USER_NOTICES"/>
        <addForeignKeyConstraint baseColumnNames="NOTICE_ID,VERSION"
                                 baseTableName="USER_NOTICES"
                                 constraintName="FK_NOTICE_TYPE_REF"
                                 referencedColumnNames="NOTICE_ID,VERSION"
                                 referencedTableName="NOTICE_TYPE_REF"/>
    </changeSet>

    <changeSet id="notices-type-ref-data-h2" author="l062951" dbms="h2" runOnChange="true">
        <comment>H2: Used to boot strap with notices version data</comment>
        <sqlFile path="persistence/data/h2/notices_type_ref_data.sql"/>
    </changeSet>

    <changeSet id="notices-type-ref-data-oracle" author="l062951" dbms="oracle" runOnChange="true">
        <comment>Oracle: Used to boot strap with notices version data</comment>
        <sqlFile endDelimiter="/" path="persistence/data/oracle/notices_type_ref_data.sql"/>
    </changeSet>

    <changeSet id="alter-draft-ca-account_election-add-percent-col" author="m039879">
        <addColumn tableName="CA_DRAFT_ACCOUNT_ELECTION">
            <column name="PERCENT" type="NUMBER"/>
        </addColumn>
    </changeSet>

</databaseChangeLog>
